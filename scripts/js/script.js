function showDangerMap(a){for(var b=a.length-1;b>=0;b--)for(var c=a.length-1;c>=0;c--)1==a[b][c]&&$(".row:eq("+b+") .tile:eq("+c+")").addClass("danger-map")}function hideDangerMap(){$(".danger-map").removeClass("danger-map")}$(function(){function a(a){for(var b=0;b<a.length;b++)for(var c=0;c<a[b].length;c++)switch(Math.abs(a[b][c])){case 0:w(b,c);break;case 1:t(b,c,"pawn "+(a[b][c]>0?"black":"white"));break;case 5.1:t(b,c,"rook "+(a[b][c]>0?"black":"white"));break;case 3.33:t(b,c,"bishop "+(a[b][c]>0?"black":"white"));break;case 3.2:t(b,c,"knight "+(a[b][c]>0?"black":"white"));break;case 8.8:t(b,c,"queen "+(a[b][c]>0?"black":"white"));break;case 41:t(b,c,"king "+(a[b][c]>0?"black":"white"))}}function b(a,b){if("white"==A(a[b[0]][b[1]])){if(data.turn)return!0}else if(!data.turn)return!0;return!1}function c(){data.turn=data.turn?0:1}function d(b,c){b[c[0]][c[1]]=0,q(data),a(b)}function e(b,c,d,e){b[c[0]][c[1]]="white"==e?-d:d,q(data),a(b)}function f(b,d,e){l(b,e)&&m(b,e),g(b,d,e),j(),k(b,d,e),Q(),p(),c(),q(data),r(),a(b)}function g(a,b,c){data.progression.push([a[b[0]][b[1]],h(b),h(c)])}function h(a){var b=["A","B","C","D","E","F","G","H"],c=["1","2","3","4","5","6","7","8"];return b[a[1]]+c[a[0]]}function i(a){var b=["A","B","C","D","E","F","G","H"];return[parseInt(a.substr(1,2))-1,b.indexOf(a.substr(0,1))]}function j(){var a=data.progression[data.progression.length-1];$(".progression").append('<div class="tracked-move">'+A(a[0])+" "+z(a[0])+" moved "+a[1]+" -> "+a[2]+"</div>")}function k(a,b,c){var d=a[b[0]][b[1]],e=a[c[0]][c[1]];return a[b[0]][b[1]]=0,a[c[0]][c[1]]=d,e}function l(a,b){return 41==Math.abs(a[b[0]][b[1]])?!0:!1}function m(a,b){$(document).off("click",".piece"),$("body").prepend(A(a[b[0]][b[1]])+" won the game! Congrats!")}function n(a){$(".row:eq("+a[0]+") .tile:eq("+a[1]+")").addClass("selected"),data.selectedPiece=a}function o(){return data.selectedPiece.length?!0:!1}function p(){$(".selected").removeClass("selected"),data.selectedPiece=[]}function q(){data.danger.white=s(data.board,"white"),data.danger.black=s(data.board,"black")}function r(){data.king.white=u(data.board,"white"),data.king.black=u(data.board,"black")}function s(a,b){var c=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],d=[];if("black"==b)for(var e=a.length-1;e>=0;e--)for(var f=a[e].length-1;f>=0;f--)a[e][f]<0&&(d=d.concat(y(a,e,f,!0)));else for(var e=a.length-1;e>=0;e--)for(var f=a[e].length-1;f>=0;f--)a[e][f]>0&&(d=d.concat(y(a,e,f,!0)));for(var e=0;e<d.length;e++)c[d[e][0]][d[e][1]]=1;return c}function t(a,b,c){$(".row:eq("+a+") .tile:eq("+b+")").html('<div class="piece '+c+'"></div>')}function u(a,b){if("black"==b){for(var c=0;c<a.length;c++)for(var d=0;d<a[c].length;d++)if(41==a[c][d])return[c,d]}else for(var c=0;c<a.length;c++)for(var d=0;d<a[c].length;d++)if(-41==a[c][d])return[c,d]}function v(a){for(var b=[],c=[],d=0;d<a.length;d++){c=[];for(var e=0;e<a[d].length;e++)c.push(a[d][e]);b.push(c)}return b}function w(a,b){$(".row:eq("+a+") .tile:eq("+b+")").html("")}function x(a,b,c){return c||(c=data.king[a]),b[c[0]][c[1]]?!0:!1}function y(a,b,c,d){if(d)switch(Math.abs(a[b][c])){case 1:return D(a,b,c);case 5.1:return F(a,b,c);case 3.33:return H(a,b,c);case 3.2:return N(a,b,c);case 8.8:return J(a,b,c);case 41:return L(a,b,c)}else switch(Math.abs(a[b][c])){case 1:return C(a,b,c);case 5.1:return E(a,b,c);case 3.33:return G(a,b,c);case 3.2:return M(a,b,c);case 8.8:return I(a,b,c);case 41:return K(a,b,c)}}function z(a){switch(Math.abs(a)){case 1:return"Pesant";case 3.2:return"Knight";case 3.33:return"Bishop";case 5.1:return"Rook";case 8.8:return"Queen";case 41:return"King";default:return"Nothing"}}function A(a){return a>0?"black":"white"}function B(b,c){var d=v(data.board),e=A(d[b[0]][b[1]]);k(d,b,c);var f=s(d,e);showDangerMap(f),a(d),hideDangerMap(),a(data.board);var g;return g=41==Math.abs(data.board[b[0]][b[1]])?x(e,f,[c[0],c[1]]):x(e,f),d=null,f=null,g}function C(a,b,c){if(1==Math.abs(a[b][c])){var d=[];if(b>0&&7>b&&0==a[b+a[b][c]][c]&&(B([b,c],[b+a[b][c],c])||d.push(b+a[b][c]==0||b+a[b][c]==7?[b+a[b][c],c,"promotion"]:[b+a[b][c],c])),(a[b][c]>0?1==b:6==b)&&0==a[b+a[b][c]][c]&&0==a[b+2*a[b][c]][c]&&(B([b,c],[b+2*a[b][c],c])||d.push([b+2*a[b][c],c])),b>0&&7>b&&(c>0&&0!=a[b+a[b][c]][c-1]&&a[b+a[b][c]][c-1]*a[b][c]<0&&(B([b,c],[b+a[b][c],c-1])||d.push(b+a[b][c]==0||b+a[b][c]==7?[b+a[b][c],c-1,"promotion"]:[b+a[b][c],c-1])),7>c&&a[b+a[b][c]][c+1]&&a[b+a[b][c]][c+1]*a[b][c]<0&&(B([b,c],[b+a[b][c],c+1])||d.push(b+a[b][c]==0||b+a[b][c]==7?[b+a[b][c],c+1,"promotion"]:[b+a[b][c],c+1]))),data.special["en passant"]){var e=A(a[b][c]);if("white"==e){if(3==b){if(c>0&&1==a[b][c-1]){var f=data.progression[data.progression.length-1],g=i(f[1]),h=i(f[2]);h[0]==b&&h[1]==c-1&&g[0]==b-2&&g[1]==c-1&&d.push([b-1,c-1,"en-passant"])}if(7>c&&1==a[b][c+1]){var f=data.progression[data.progression.length-1],g=i(f[1]),h=i(f[2]);h[0]==b&&h[1]==c+1&&g[0]==b-2&&g[1]==c+1&&d.push([b-1,c+1,"en-passant"])}}}else if(4==b){if(c>0&&-1==a[b][c-1]){var f=data.progression[data.progression.length-1],g=i(f[1]),h=i(f[2]);h[0]==b&&h[1]==c-1&&g[0]==b+2&&g[1]==c-1&&d.push([b+1,c-1,"en-passant"])}if(7>c&&-1==a[b][c+1]){var f=data.progression[data.progression.length-1],g=i(f[1]),h=i(f[2]);h[0]==b&&h[1]==c+1&&g[0]==b+2&&g[1]==c+1&&d.push([b+1,c+1,"en-passant"])}}}return d}}function D(a,b,c){if(1==Math.abs(a[b][c])){var d=[];return b>0&&7>b&&(c>0&&d.push([b+a[b][c],c-1]),7>c&&d.push([b+a[b][c],c+1])),d}}function E(a,b,c){if(5.1==Math.abs(a[b][c])){for(var d=[],e=1,f=!1;b-e>=0&&!f;)0==a[b-e][c]?B([b,c],[b-e,c])||d.push([b-e,c]):a[b-e][c]*a[b][c]>0?f=!0:(B([b,c],[b-e,c])||d.push([b-e,c]),f=!0),e++;var g=1;for(f=!1;7>=b+g&&!f;)0==a[b+g][c]?B([b,c],[b+g,c])||d.push([b+g,c]):a[b+g][c]*a[b][c]>0?f=!0:(B([b,c],[b+g,c])||d.push([b+g,c]),f=!0),g++;var h=1;for(f=!1;c-h>=0&&!f;)0==a[b][c-h]?B([b,c],[b,c-h])||d.push([b,c-h]):a[b][c-h]*a[b][c]>0?f=!0:(B([b,c],[b,c-h])||d.push([b,c-h]),f=!0),h++;var i=1;for(f=!1;7>=c+i&&!f;)0==a[b][c+i]?B([b,c],[b,c+i])||d.push([b,c+i]):a[b][c+i]*a[b][c]>0?f=!0:(B([b,c],[b,c+i])||d.push([b,c+i]),f=!0),i++;return d}}function F(a,b,c){if(5.1==Math.abs(a[b][c])){for(var d=[],e=1,f=!1;b-e>=0&&!f;)0==a[b-e][c]?d.push([b-e,c]):a[b-e][c]*a[b][c]>0?(d.push([b-e,c]),f=!0):(d.push([b-e,c]),f=!0),e++;var g=1;for(f=!1;7>=b+g&&!f;)0==a[b+g][c]?d.push([b+g,c]):a[b+g][c]*a[b][c]>0?(d.push([b+g,c]),f=!0):(d.push([b+g,c]),f=!0),g++;var h=1;for(f=!1;c-h>=0&&!f;)0==a[b][c-h]?d.push([b,c-h]):a[b][c-h]*a[b][c]>0?(d.push([b,c-h]),f=!0):(d.push([b,c-h]),f=!0),h++;var i=1;for(f=!1;7>=c+i&&!f;)0==a[b][c+i]?d.push([b,c+i]):a[b][c+i]*a[b][c]>0?(d.push([b,c+i]),f=!0):(d.push([b,c+i]),f=!0),i++;return d}}function G(a,b,c){if(3.33==Math.abs(a[b][c])){for(var d=[],e=1,f=1,g=1,h=!1,i=!1;c-e>=0&&(!h||!i);)b-f>=0&&!h?0==a[b-f][c-e]?B([b,c],[b-f,c-e])||d.push([b-f,c-e]):a[b-f][c-e]*a[b][c]>0?h=!0:(B([b,c],[b-f,c-e])||d.push([b-f,c-e]),h=!0):h=!0,f++,7>=b+g&&!i?0==a[b+g][c-e]?B([b,c],[b+g,c-e])||d.push([b+g,c-e]):a[b+g][c-e]*a[b][c]>0?i=!0:(B([b,c],[b+g,c-e])||d.push([b+g,c-e]),i=!0):i=!0,g++,e++;var j=1;for(e=1,f=1,g=1,h=!1,i=!1;7>=c+j&&(!h||!i);)b-f>=0&&!h?0==a[b-f][c+j]?B([b,c],[b-f,c+j])||d.push([b-f,c+j]):a[b-f][c+j]*a[b][c]>0?h=!0:(B([b,c],[b-f,c+j])||d.push([b-f,c+j]),h=!0):h=!0,f++,7>=b+g&&!i?0==a[b+g][c+j]?B([b,c],[b+g,c+j])||d.push([b+g,c+j]):a[b+g][c+j]*a[b][c]>0?i=!0:(B([b,c],[b+g,c+j])||d.push([b+g,c+j]),i=!0):i=!0,g++,j++;return d}}function H(a,b,c){if(3.33==Math.abs(a[b][c])){for(var d=[],e=1,f=1,g=1,h=!1,i=!1;c-e>=0&&(!h||!i);)b-f>=0&&!h?0==a[b-f][c-e]?d.push([b-f,c-e]):a[b-f][c-e]*a[b][c]>0?(d.push([b-f,c-e]),h=!0):(d.push([b-f,c-e]),h=!0):h=!0,f++,7>=b+g&&!i?0==a[b+g][c-e]?d.push([b+g,c-e]):a[b+g][c-e]*a[b][c]>0?(d.push([b+g,c-e]),i=!0):(d.push([b+g,c-e]),i=!0):i=!0,g++,e++;var j=1;for(e=1,f=1,g=1,h=!1,i=!1;7>=c+j&&(!h||!i);)b-f>=0&&!h?0==a[b-f][c+j]?d.push([b-f,c+j]):a[b-f][c+j]*a[b][c]>0?(d.push([b-f,c+j]),h=!0):(d.push([b-f,c+j]),h=!0):h=!0,f++,7>=b+g&&!i?0==a[b+g][c+j]?d.push([b+g,c+j]):a[b+g][c+j]*a[b][c]>0?(d.push([b+g,c+j]),i=!0):(d.push([b+g,c+j]),i=!0):i=!0,g++,j++;return d}}function I(a,b,c){if(8.8==Math.abs(a[b][c])){for(var d=[],e=1,f=!1;b-e>=0&&!f;)0==a[b-e][c]?B([b,c],[b-e,c])||d.push([b-e,c]):a[b-e][c]*a[b][c]>0?f=!0:(B([b,c],[b-e,c])||d.push([b-e,c]),f=!0),e++;var g=1;for(f=!1;7>=b+g&&!f;)0==a[b+g][c]?B([b,c],[b+g,c])||d.push([b+g,c]):a[b+g][c]*a[b][c]>0?f=!0:(B([b,c],[b+g,c])||d.push([b+g,c]),f=!0),g++;var h=1;for(f=!1;c-h>=0&&!f;)0==a[b][c-h]?B([b,c],[b,c-h])||d.push([b,c-h]):a[b][c-h]*a[b][c]>0?f=!0:(B([b,c],[b,c-h])||d.push([b,c-h]),f=!0),h++;var i=1;for(f=!1;7>=c+i&&!f;)0==a[b][c+i]?B([b,c],[b,c+i])||d.push([b,c+i]):a[b][c+i]*a[b][c]>0?f=!0:(B([b,c],[b,c+i])||d.push([b,c+i]),f=!0),i++;h=1,e=1,g=1;for(var j=!1,k=!1;c-h>=0&&(!j||!k);)b-e>=0&&!j?0==a[b-e][c-h]?B([b,c],[b-e,c-h])||d.push([b-e,c-h]):a[b-e][c-h]*a[b][c]>0?j=!0:(B([b,c],[b-e,c-h])||d.push([b-e,c-h]),j=!0):j=!0,e++,7>=b+g&&!k?0==a[b+g][c-h]?B([b,c],[b+g,c-h])||d.push([b+g,c-h]):a[b+g][c-h]*a[b][c]>0?k=!0:(B([b,c],[b+g,c-h])||d.push([b+g,c-h]),k=!0):k=!0,g++,h++;for(i=1,h=1,e=1,g=1,j=!1,k=!1;7>=c+i&&(!j||!k);)b-e>=0&&!j?0==a[b-e][c+i]?B([b,c],[b-e,c+i])||d.push([b-e,c+i]):a[b-e][c+i]*a[b][c]>0?j=!0:(B([b,c],[b-e,c+i])||d.push([b-e,c+i]),j=!0):j=!0,e++,7>=b+g&&!k?0==a[b+g][c+i]?B([b,c],[b+g,c+i])||d.push([b+g,c+i]):a[b+g][c+i]*a[b][c]>0?k=!0:(B([b,c],[b+g,c+i])||d.push([b+g,c+i]),k=!0):k=!0,g++,i++;return d}}function J(a,b,c){if(8.8==Math.abs(a[b][c])){for(var d=[],e=1,f=!1;b-e>=0&&!f;)0==a[b-e][c]?d.push([b-e,c]):a[b-e][c]*a[b][c]>0?(d.push([b-e,c]),f=!0):(d.push([b-e,c]),f=!0),e++;var g=1;for(f=!1;7>=b+g&&!f;)0==a[b+g][c]?d.push([b+g,c]):a[b+g][c]*a[b][c]>0?(d.push([b+g,c]),f=!0):(d.push([b+g,c]),f=!0),g++;var h=1;for(f=!1;c-h>=0&&!f;)0==a[b][c-h]?d.push([b,c-h]):a[b][c-h]*a[b][c]>0?(d.push([b,c-h]),f=!0):(d.push([b,c-h]),f=!0),h++;var i=1;for(f=!1;7>=c+i&&!f;)0==a[b][c+i]?d.push([b,c+i]):a[b][c+i]*a[b][c]>0?(d.push([b,c+i]),f=!0):(d.push([b,c+i]),f=!0),i++;h=1,e=1,g=1;for(var j=!1,k=!1;c-h>=0&&(!j||!k);)b-e>=0&&!j?0==a[b-e][c-h]?d.push([b-e,c-h]):a[b-e][c-h]*a[b][c]>0?(d.push([b-e,c-h]),j=!0):(d.push([b-e,c-h]),j=!0):j=!0,e++,7>=b+g&&!k?0==a[b+g][c-h]?d.push([b+g,c-h]):a[b+g][c-h]*a[b][c]>0?(d.push([b+g,c-h]),k=!0):(d.push([b+g,c-h]),k=!0):k=!0,g++,h++;var i=1;for(h=1,e=1,g=1,j=!1,k=!1;7>=c+i&&(!j||!k);)b-e>=0&&!j?0==a[b-e][c+i]?d.push([b-e,c+i]):a[b-e][c+i]*a[b][c]>0?(d.push([b-e,c+i]),j=!0):(d.push([b-e,c+i]),j=!0):j=!0,e++,7>=b+g&&!k?0==a[b+g][c+i]?d.push([b+g,c+i]):a[b+g][c+i]*a[b][c]>0?(d.push([b+g,c+i]),k=!0):(d.push([b+g,c+i]),k=!0):k=!0,g++,i++;return d}}function K(a,b,c){if(41==Math.abs(a[b][c])){var d=[];if(b>0&&(0==a[b-1][c]?B([b,c],[b-1,c])||d.push([b-1,c]):a[b-1][c]*a[b][c]<0&&(B([b,c],[b-1,c])||d.push([b-1,c])),c>0&&(0==a[b-1][c-1]?B([b,c],[b-1,c-1])||d.push([b-1,c-1]):a[b-1][c-1]*a[b][c]<0&&(B([b,c],[b-1,c-1])||d.push([b-1,c-1]))),7>c&&(0==a[b-1][c+1]?B([b,c],[b-1,c+1])||d.push([b-1,c+1]):a[b-1][c+1]*a[b][c]<0&&(B([b,c],[b-1,c+1])||d.push([b-1,c+1])))),c>0&&(0==a[b][c-1]?B([b,c],[b,c-1])||d.push([b,c-1]):a[b][c-1]*a[b][c]<0&&(B([b,c],[b,c-1])||d.push([b,c-1]))),7>c&&(0==a[b][c+1]?B([b,c],[b,c+1])||d.push([b,c+1]):a[b][c+1]*a[b][c]<0&&(B([b,c],[b,c+1])||d.push([b,c+1]))),7>b&&(0==a[b+1][c]?B([b,c],[b+1,c])||d.push([b+1,c]):a[b+1][c]*a[b][c]<0&&(B([b,c],[b+1,c])||d.push([b+1,c])),c>0&&(0==a[b+1][c-1]?B([b,c],[b+1,c-1])||d.push([b+1,c-1]):a[b+1][c-1]*a[b][c]<0&&(B([b,c],[b+1,c-1])||d.push([b+1,c-1]))),7>c&&(0==a[b+1][c+1]?B([b,c],[b+1,c+1])||d.push([b+1,c+1]):a[b+1][c+1]*a[b][c]<0&&(B([b,c],[b+1,c+1])||d.push([b+1,c+1])))),data.special.casteling&&!O(a[b][c])){var e=a[b][c]<0?-5.1:5.1,f=A(a[b][c]),g=data.danger[f];a[b][7]==e&&(O(e,[b,7])||0==a[b][6]&&0==a[b][5]&&(x(f,g,[b,5])||x(f,g,[b,6])||x(f,g)||B([b,c],[b,6])||d.push([b,6,"casteling"]))),a[b][0]==e&&(O(e,[b,0])||0==a[b][1]&&0==a[b][2]&&0==a[b][3]&&(x(f,g,[b,2])||x(f,g,[b,3])||x(f,g)||B([b,c],[b,2])||d.push([b,2,"casteling"])))}return d}}function L(a,b,c){if(41==Math.abs(a[b][c])){var d=[];return b>0&&(d.push([b-1,c]),c>0&&d.push([b-1,c-1]),7>c&&d.push([b-1,c+1])),c>0&&d.push([b,c-1]),7>c&&d.push([b,c+1]),7>b&&(d.push([b+1,c]),c>0&&d.push([b+1,c-1]),7>c&&d.push([b+1,c+1])),d}}function M(a,b,c){if(3.2==Math.abs(a[b][c])){var d=[];return b>0&&c>1&&(0==a[b-1][c-2]||a[b-1][c-2]*a[b][c]<0)&&(B([b,c],[b-1,c-2])||d.push([b-1,c-2])),b>0&&6>c&&(0==a[b-1][c+2]||a[b-1][c+2]*a[b][c]<0)&&(B([b,c],[b-1,c+2])||d.push([b-1,c+2])),b>1&&c>0&&(0==a[b-2][c-1]||a[b-2][c-1]*a[b][c]<0)&&(B([b,c],[b-2,c-1])||d.push([b-2,c-1])),b>1&&7>c&&(0==a[b-2][c+1]||a[b-2][c+1]*a[b][c]<0)&&(B([b,c],[b-2,c+1])||d.push([b-2,c+1])),7>b&&c>1&&(0==a[b+1][c-2]||a[b+1][c-2]*a[b][c]<0)&&(B([b,c],[b+1,c-2])||d.push([b+1,c-2])),7>b&&6>c&&(0==a[b+1][c+2]||a[b+1][c+2]*a[b][c]<0)&&(B([b,c],[b+1,c+2])||d.push([b+1,c+2])),6>b&&c>0&&(0==a[b+2][c-1]||a[b+2][c-1]*a[b][c]<0)&&(B([b,c],[b+2,c-1])||d.push([b+2,c-1])),6>b&&7>c&&(0==a[b+2][c+1]||a[b+2][c+1]*a[b][c]<0)&&(B([b,c],[b+2,c+1])||d.push([b+2,c+1])),d}}function N(a,b,c){if(3.2==Math.abs(a[b][c])){var d=[];return b>0&&c>1&&d.push([b-1,c-2]),b>0&&6>c&&d.push([b-1,c+2]),b>1&&c>0&&d.push([b-2,c-1]),b>1&&7>c&&d.push([b-2,c+1]),7>b&&c>1&&d.push([b+1,c-2]),7>b&&6>c&&d.push([b+1,c+2]),6>b&&c>0&&d.push([b+2,c-1]),6>b&&7>c&&d.push([b+2,c+1]),d}}function O(a,b){for(var c=data.progression.length-1;c>=0;c--)if(data.progression[c][0]==a){if(!b)return!0;var d=i(data.progression[c][1]);if(d[0]==b[0]&&d[1]==b[1])return!0}return!1}function P(a){for(var b=a.length-1;b>=0;b--)$(".row:eq("+a[b][0]+") .tile:eq("+a[b][1]+")").addClass("possibility"),a[b].length>2&&$(".row:eq("+a[b][0]+") .tile:eq("+a[b][1]+")").addClass(a[b][2])}function Q(){$(".possibility").removeClass("possibility")}window.data={board:[[5.1,3.2,3.33,8.8,41,3.33,3.2,5.1],[1,-1,1,1,1,1,1,-1],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[-1,-1,-1,-1,-1,-1,-1,-1],[-5.1,-3.2,-3.33,-8.8,-41,-3.33,-3.2,-5.1]],progression:[],selectedPiece:[],turn:1,king:{white:"",black:""},danger:{white:"",black:""},special:{casteling:!0,"en passant":!0,promotion:!1}},r(),q(),a(data.board),$(document).on("click",".piece",function(){if(!$(this).parent().hasClass("possibility")){var a=$(".row .tile").index($(this).parent())%8,c=Math.floor($(".row .tile").index($(this).parent())/8);if(b(data.board,[c,a])){o()&&(Q(),p());var d=y(data.board,c,a);d&&P(d),n([c,a])}}}),$(document).on("click",".possibility",function(){if(o()){var a=$(".row .tile").index(this)%8,b=Math.floor($(".row .tile").index(this)/8);if(f(data.board,data.selectedPiece,[b,a]),$(this).hasClass("casteling")&&($(this).removeClass("casteling"),7==b?a>4?(f(data.board,[7,7],[b,a-1]),c()):(f(data.board,[7,0],[b,a+1]),c()):0==b&&(a>4?(f(data.board,[0,7],[b,a-1]),c()):(f(data.board,[0,0],[b,a+1]),c()))),$(this).hasClass("en-passant")){$(this).removeClass("en-passant");var g=A(data.board[b][a]);"white"==g?d(data.board,[b+1,a]):d(data.board,[b-1,a])}$(this).hasClass("promotion")&&($(this).removeClass("promotion"),$(".choose").show(),$(".choose").data("i",b),$(".choose").data("j",a),$(".choose").on("change",function(){$(".choose").off("change").hide(),$(".choose option").each(function(){$(this).is(":selected")&&e(data.board,[$(this).parent().data("i"),$(this).parent().data("j")],$(this).val(),A(data.board[$(this).parent().data("i")][$(this).parent().data("j")])),$(this).attr("selected",!1)})}))}})});