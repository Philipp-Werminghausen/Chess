function showDangerMap(a){for(var b=a.length-1;b>=0;b--)for(var c=a.length-1;c>=0;c--)1==a[b][c]&&$(".row:eq("+b+") .tile:eq("+c+")").addClass("danger-map")}function hideDangerMap(){$(".danger-map").removeClass("danger-map")}$(function(){function a(a){for(var b=0;b<a.length;b++)for(var d=0;d<a[b].length;d++)switch(Math.abs(a[b][d])){case 0:f(b,d);break;case 1:c(b,d,"pawn "+(a[b][d]>0?"black":"white"));break;case 5.1:c(b,d,"rook "+(a[b][d]>0?"black":"white"));break;case 3.33:c(b,d,"bishop "+(a[b][d]>0?"black":"white"));break;case 3.2:c(b,d,"knight "+(a[b][d]>0?"black":"white"));break;case 8.8:c(b,d,"queen "+(a[b][d]>0?"black":"white"));break;case 41:c(b,d,"king "+(a[b][d]>0?"black":"white"))}}function b(a,b){var c=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],d=[];if("black"==b)for(var e=a.length-1;e>=0;e--)for(var f=a.length-1;f>=0;f--)a[e][f]<0&&(d=d.concat(h(a,e,f,!0)));else for(var e=a.length-1;e>=0;e--)for(var f=a.length-1;f>=0;f--)a[e][f]>0&&(d=d.concat(h(a,e,f,!0)));for(var e=d.length-1;e>=0;e--)c[d[e][0]][d[e][1]]=1;return c}function c(a,b,c){$(".row:eq("+a+") .tile:eq("+b+")").html('<div class="piece '+c+'"></div>')}function d(a){if("black"==a){for(var b=0;b<board.length;b++)for(var c=0;c<board[b].length;c++)if(41==board[b][c])return[b,c]}else for(var b=0;b<board.length;b++)for(var c=0;c<board[b].length;c++)if(-41==board[b][c])return[b,c]}function e(a){for(var b=[],c=[],d=0;d<a.length;d++){c=[];for(var e=0;e<a[d].length;e++)c.push(a[d][e]);b.push(c)}return b}function f(a,b){$(".row:eq("+a+") .tile:eq("+b+")").html("")}function g(a,b,c){return"black"==a?b[c?c[0]:y[0]][c?c[1]:y[1]]?!0:!1:b[c?c[0]:x[0]][c?c[1]:x[1]]?!0:!1}function h(a,b,c,d){if(d)switch(Math.abs(a[b][c])){case 1:return k(a,b,c);case 5.1:return m(a,b,c);case 3.33:return o(a,b,c);case 3.2:return u(a,b,c);case 8.8:return q(a,b,c);case 41:return s(a,b,c)}else switch(Math.abs(a[b][c])){case 1:return j(a,b,c);case 5.1:return l(a,b,c);case 3.33:return n(a,b,c);case 3.2:return t(a,b,c);case 8.8:return p(a,b,c);case 41:return r(a,b,c)}}function i(a,c,d){var f=e(board),h=f[a[0]][a[1]];f[a[0]][a[1]]=0,f[c[0]][c[1]]=h,d="black"==d?"white":"black";var i,j=b(f,d);return i=41==Math.abs(board[a[0]][a[1]])?g(d,j,[c[0],c[1]]):g(d,j),showDangerMap(j),hideDangerMap(),f=null,j=null,i}function j(a,b,c){if(1==Math.abs(a[b][c])){var d=[];return(b>0||7>b)&&0==a[b+a[b][c]][c]&&(i([b,c],[b+a[b][c],c],a[b][c]<0?"black":"white")||d.push([b+a[b][c],c])),(a[b][c]>0?1==b:6==b)&&0==a[b+a[b][c]][c]&&0==a[b+2*a[b][c]][c]&&(i([b,c],[b+2*a[b][c],c],a[b][c]<0?"black":"white")||d.push([b+2*a[b][c],c])),(b>0||7>b)&&(c>0&&0!=a[b+a[b][c]][c-1]&&a[b+a[b][c]][c-1]*a[b][c]<0&&(i([b,c],[b+a[b][c],c-1],a[b][c]<0?"black":"white")||d.push([b+a[b][c],c-1])),7>c&&a[b+a[b][c]][c+1]&&a[b+a[b][c]][c+1]*a[b][c]<0&&(i([b,c],[b+a[b][c],c+1],a[b][c]<0?"black":"white")||d.push([b+a[b][c],c+1]))),d}}function k(a,b,c){if(1==Math.abs(a[b][c])){var d=[];return(b>0||7>b)&&(c>0&&d.push([b+a[b][c],c-1]),7>c&&d.push([b+a[b][c],c+1])),d}}function l(a,b,c){if(5.1==Math.abs(a[b][c])){for(var d=[],e=1,f=!1;b-e>=0&&!f;)0==a[b-e][c]?i([b,c],[b-e,c],a[b][c]<0?"black":"white")||d.push([b-e,c]):a[b-e][c]*a[b][c]>0?f=!0:(i([b,c],[b-e,c],a[b][c]<0?"black":"white")||d.push([b-e,c]),f=!0),e++;var g=1;for(f=!1;7>b+g&&!f;)0==a[b+g][c]?i([b,c],[b+g,c],a[b][c]<0?"black":"white")||d.push([b+g,c]):a[b+g][c]*a[b][c]>0?f=!0:(i([b,c],[b+g,c],a[b][c]<0?"black":"white")||d.push([b+g,c]),f=!0),g++;var h=1;for(f=!1;c-h>=0&&!f;)0==a[b][c-h]?i([b,c],[b,c-h],a[b][c]<0?"black":"white")||d.push([b,c-h]):a[b][c-h]*a[b][c]>0?f=!0:(i([b,c],[b,c-h],a[b][c]<0?"black":"white")||d.push([b,c-h]),f=!0),h++;var j=1;for(f=!1;7>=c+j&&!f;)0==a[b][c+j]?i([b,c],[b,c+j],a[b][c]<0?"black":"white")||d.push([b,c+j]):a[b][c+j]*a[b][c]>0?f=!0:(i([b,c],[b,c+j],a[b][c]<0?"black":"white")||d.push([b,c+j]),f=!0),j++;return d}}function m(a,b,c){if(5.1==Math.abs(a[b][c])){for(var d=[],e=1,f=!1;b-e>=0&&!f;)0==a[b-e][c]?d.push([b-e,c]):a[b-e][c]*a[b][c]>0?(d.push([b-e,c]),f=!0):(d.push([b-e,c]),f=!0),e++;var g=1;for(f=!1;7>b+g&&!f;)0==a[b+g][c]?d.push([b+g,c]):a[b+g][c]*a[b][c]>0?(d.push([b+g,c]),f=!0):(d.push([b+g,c]),f=!0),g++;var h=1;for(f=!1;c-h>=0&&!f;)0==a[b][c-h]?d.push([b,c-h]):a[b][c-h]*a[b][c]>0?(d.push([b,c-h]),f=!0):(d.push([b,c-h]),f=!0),h++;var i=1;for(f=!1;7>=c+i&&!f;)0==a[b][c+i]?d.push([b,c+i]):a[b][c+i]*a[b][c]>0?(d.push([b,c+i]),f=!0):(d.push([b,c+i]),f=!0),i++;return d}}function n(a,b,c){if(3.33==Math.abs(a[b][c])){for(var d=[],e=1,f=1,g=1,h=!1,j=!1;c-e>=0&&(!h||!j);)b-f>=0&&!h?0==a[b-f][c-e]?i([b,c],[b-f,c-e],a[b][c]<0?"black":"white")||d.push([b-f,c-e]):a[b-f][c-e]*a[b][c]>0?h=!0:(i([b,c],[b-f,c-e],a[b][c]<0?"black":"white")||d.push([b-f,c-e]),h=!0):h=!0,f++,7>=b+g&&!j?0==a[b+g][c-e]?i([b,c],[b+g,c-e],a[b][c]<0?"black":"white")||d.push([b+g,c-e]):a[b+g][c-e]*a[b][c]>0?j=!0:(i([b,c],[b+g,c-e],a[b][c]<0?"black":"white")||d.push([b+g,c-e]),j=!0):j=!0,g++,e++;var k=1;for(e=1,f=1,g=1,h=!1,j=!1;7>=c+k&&(!h||!j);)b-f>=0&&!h?0==a[b-f][c+k]?i([b,c],[b-f,c+k],a[b][c]<0?"black":"white")||d.push([b-f,c+k]):a[b-f][c+k]*a[b][c]>0?h=!0:(i([b,c],[b-f,c+k],a[b][c]<0?"black":"white")||d.push([b-f,c+k]),h=!0):h=!0,f++,7>=b+g&&!j?0==a[b+g][c+k]?i([b,c],[b+g,c+k],a[b][c]<0?"black":"white")||d.push([b+g,c+k]):a[b+g][c+k]*a[b][c]>0?j=!0:(i([b,c],[b+g,c+k],a[b][c]<0?"black":"white")||d.push([b+g,c+k]),j=!0):j=!0,g++,k++;return d}}function o(a,b,c){if(3.33==Math.abs(a[b][c])){for(var d=[],e=1,f=1,g=1,h=!1,i=!1;c-e>=0&&(!h||!i);)b-f>=0&&!h?0==a[b-f][c-e]?d.push([b-f,c-e]):a[b-f][c-e]*a[b][c]>0?(d.push([b-f,c-e]),h=!0):(d.push([b-f,c-e]),h=!0):h=!0,f++,7>=b+g&&!i?0==a[b+g][c-e]?d.push([b+g,c-e]):a[b+g][c-e]*a[b][c]>0?(d.push([b+g,c-e]),i=!0):(d.push([b+g,c-e]),i=!0):i=!0,g++,e++;var j=1;for(e=1,f=1,g=1,h=!1,i=!1;7>=c+j&&(!h||!i);)b-f>=0&&!h?0==a[b-f][c+j]?d.push([b-f,c+j]):a[b-f][c+j]*a[b][c]>0?(d.push([b-f,c+j]),h=!0):(d.push([b-f,c+j]),h=!0):h=!0,f++,7>=b+g&&!i?0==a[b+g][c+j]?d.push([b+g,c+j]):a[b+g][c+j]*a[b][c]>0?(d.push([b+g,c+j]),i=!0):(d.push([b+g,c+j]),i=!0):i=!0,g++,j++;return d}}function p(a,b,c){if(8.8==Math.abs(a[b][c])){for(var d=[],e=1,f=!1;b-e>=0&&!f;)0==a[b-e][c]?i([b,c],[b-e,c],a[b][c]<0?"black":"white")||d.push([b-e,c]):a[b-e][c]*a[b][c]>0?f=!0:(i([b,c],[b-e,c],a[b][c]<0?"black":"white")||d.push([b-e,c]),f=!0),e++;var g=1;for(f=!1;7>b+g&&!f;)0==a[b+g][c]?i([b,c],[b+g,c],a[b][c]<0?"black":"white")||d.push([b+g,c]):a[b+g][c]*a[b][c]>0?f=!0:(i([b,c],[b+g,c],a[b][c]<0?"black":"white")||d.push([b+g,c]),f=!0),g++;var h=1;for(f=!1;c-h>=0&&!f;)0==a[b][c-h]?i([b,c],[b,c-h],a[b][c]<0?"black":"white")||d.push([b,c-h]):a[b][c-h]*a[b][c]>0?f=!0:(i([b,c],[b,c-h],a[b][c]<0?"black":"white")||d.push([b,c-h]),f=!0),h++;var j=1;for(f=!1;7>=c+j&&!f;)0==a[b][c+j]?i([b,c],[b,c+j],a[b][c]<0?"black":"white")||d.push([b,c+j]):a[b][c+j]*a[b][c]>0?f=!0:(i([b,c],[b,c+j],a[b][c]<0?"black":"white")||d.push([b,c+j]),f=!0),j++;h=1,e=1,g=1;for(var k=!1,l=!1;c-h>=0&&(!k||!l);)b-e>=0&&!k?0==a[b-e][c-h]?i([b,c],[b-e,c-h],a[b][c]<0?"black":"white")||d.push([b-e,c-h]):a[b-e][c-h]*a[b][c]>0?k=!0:(i([b,c],[b-e,c-h],a[b][c]<0?"black":"white")||d.push([b-e,c-h]),k=!0):k=!0,e++,7>=b+g&&!l?0==a[b+g][c-h]?i([b,c],[b+g,c-h],a[b][c]<0?"black":"white")||d.push([b+g,c-h]):a[b+g][c-h]*a[b][c]>0?l=!0:(i([b,c],[b+g,c-h],a[b][c]<0?"black":"white")||d.push([b+g,c-h]),l=!0):l=!0,g++,h++;for(j=1,h=1,e=1,g=1,k=!1,l=!1;7>=c+j&&(!k||!l);)b-e>=0&&!k?0==a[b-e][c+j]?i([b,c],[b-e,c+j],a[b][c]<0?"black":"white")||d.push([b-e,c+j]):a[b-e][c+j]*a[b][c]>0?k=!0:(i([b,c],[b-e,c+j],a[b][c]<0?"black":"white")||d.push([b-e,c+j]),k=!0):k=!0,e++,7>=b+g&&!l?0==a[b+g][c+j]?i([b,c],[b+g,c+j],a[b][c]<0?"black":"white")||d.push([b+g,c+j]):a[b+g][c+j]*a[b][c]>0?l=!0:(i([b,c],[b+g,c+j],a[b][c]<0?"black":"white")||d.push([b+g,c+j]),l=!0):l=!0,g++,j++;return d}}function q(a,b,c){if(8.8==Math.abs(a[b][c])){for(var d=[],e=1,f=!1;b-e>=0&&!f;)0==a[b-e][c]?d.push([b-e,c]):a[b-e][c]*a[b][c]>0?(d.push([b-e,c]),f=!0):(d.push([b-e,c]),f=!0),e++;var g=1;for(f=!1;7>b+g&&!f;)0==a[b+g][c]?d.push([b+g,c]):a[b+g][c]*a[b][c]>0?(d.push([b+g,c]),f=!0):(d.push([b+g,c]),f=!0),g++;var h=1;for(f=!1;c-h>=0&&!f;)0==a[b][c-h]?d.push([b,c-h]):a[b][c-h]*a[b][c]>0?(d.push([b,c-h]),f=!0):(d.push([b,c-h]),f=!0),h++;var i=1;for(f=!1;7>=c+i&&!f;)0==a[b][c+i]?d.push([b,c+i]):a[b][c+i]*a[b][c]>0?(d.push([b,c+i]),f=!0):(d.push([b,c+i]),f=!0),i++;h=1,e=1,g=1;for(var j=!1,k=!1;c-h>=0&&(!j||!k);)b-e>=0&&!j?0==a[b-e][c-h]?d.push([b-e,c-h]):a[b-e][c-h]*a[b][c]>0?(d.push([b-e,c-h]),j=!0):(d.push([b-e,c-h]),j=!0):j=!0,e++,7>=b+g&&!k?0==a[b+g][c-h]?d.push([b+g,c-h]):a[b+g][c-h]*a[b][c]>0?(d.push([b+g,c-h]),k=!0):(d.push([b+g,c-h]),k=!0):k=!0,g++,h++;var i=1;for(h=1,e=1,g=1,j=!1,k=!1;7>=c+i&&(!j||!k);)b-e>=0&&!j?0==a[b-e][c+i]?d.push([b-e,c+i]):a[b-e][c+i]*a[b][c]>0?(d.push([b-e,c+i]),j=!0):(d.push([b-e,c+i]),j=!0):j=!0,e++,7>=b+g&&!k?0==a[b+g][c+i]?d.push([b+g,c+i]):a[b+g][c+i]*a[b][c]>0?(d.push([b+g,c+i]),k=!0):(d.push([b+g,c+i]),k=!0):k=!0,g++,i++;return d}}function r(a,b,c){if(41==Math.abs(a[b][c])){var d=[];return b>0&&(0==a[b-1][c]?i([b,c],[b-1,c],a[b][c]<0?"black":"white")||d.push([b-1,c]):a[b-1][c]*a[b][c]<0&&(i([b,c],[b-1,c],a[b][c]<0?"black":"white")||d.push([b-1,c])),c>0&&(0==a[b-1][c-1]?i([b,c],[b-1,c-1],a[b][c]<0?"black":"white")||d.push([b-1,c-1]):a[b-1][c-1]*a[b][c]<0&&(i([b,c],[b-1,c-1],a[b][c]<0?"black":"white")||d.push([b-1,c-1]))),7>c&&(0==a[b-1][c+1]?i([b,c],[b-1,c+1],a[b][c]<0?"black":"white")||d.push([b-1,c+1]):a[b-1][c+1]*a[b][c]<0&&(i([b,c],[b-1,c+1],a[b][c]<0?"black":"white")||d.push([b-1,c+1])))),c>0&&(0==a[b][c-1]?i([b,c],[b,c-1],a[b][c]<0?"black":"white")||d.push([b,c-1]):a[b][c-1]*a[b][c]<0&&(i([b,c],[b,c-1],a[b][c]<0?"black":"white")||d.push([b,c-1]))),7>c&&(0==a[b][c+1]?i([b,c],[b,c+1],a[b][c]<0?"black":"white")||d.push([b,c+1]):a[b][c+1]*a[b][c]<0&&(i([b,c],[b,c+1],a[b][c]<0?"black":"white")||d.push([b,c+1]))),7>b&&(0==a[b+1][c]?i([b,c],[b+1,c],a[b][c]<0?"black":"white")||d.push([b+1,c]):a[b+1][c]*a[b][c]<0&&(i([b,c],[b+1,c],a[b][c]<0?"black":"white")||d.push([b+1,c])),c>0&&(0==a[b+1][c-1]?i([b,c],[b+1,c-1],a[b][c]<0?"black":"white")||d.push([b+1,c-1]):a[b+1][c-1]*a[b][c]<0&&(i([b,c],[b+1,c-1],a[b][c]<0?"black":"white")||d.push([b+1,c-1]))),7>c&&(0==a[b+1][c+1]?i([b,c],[b+1,c+1],a[b][c]<0?"black":"white")||d.push([b+1,c+1]):a[b+1][c+1]*a[b][c]<0&&(i([b,c],[b+1,c+1],a[b][c]<0?"black":"white")||d.push([b+1,c+1])))),d}}function s(a,b,c){if(41==Math.abs(a[b][c])){var d=[];return b>0&&(d.push([b-1,c]),c>0&&d.push([b-1,c-1]),7>c&&d.push([b-1,c+1])),c>0&&d.push([b,c-1]),7>c&&d.push([b,c+1]),7>b&&(d.push([b+1,c]),c>0&&d.push([b+1,c-1]),7>c&&d.push([b+1,c+1])),d}}function t(a,b,c){if(3.2==Math.abs(a[b][c])){var d=[];return b>0&&c>1&&(0==a[b-1][c-2]||a[b-1][c-2]*a[b][c]<0)&&(i([b,c],[b-1,c-2],a[b][c]<0?"black":"white")||d.push([b-1,c-2])),b>0&&6>c&&(0==a[b-1][c+2]||a[b-1][c+2]*a[b][c]<0)&&(i([b,c],[b-1,c+2],a[b][c]<0?"black":"white")||d.push([b-1,c+2])),b>1&&c>0&&(0==a[b-2][c-1]||a[b-2][c-1]*a[b][c]<0)&&(i([b,c],[b-2,c-1],a[b][c]<0?"black":"white")||d.push([b-2,c-1])),b>1&&7>c&&(0==a[b-2][c+1]||a[b-2][c+1]*a[b][c]<0)&&(i([b,c],[b-2,c+1],a[b][c]<0?"black":"white")||d.push([b-2,c+1])),7>b&&c>1&&(0==a[b+1][c-2]||a[b+1][c-2]*a[b][c]<0)&&(i([b,c],[b+1,c-2],a[b][c]<0?"black":"white")||d.push([b+1,c-2])),7>b&&6>c&&(0==a[b+1][c+2]||a[b+1][c+2]*a[b][c]<0)&&(i([b,c],[b+1,c+2],a[b][c]<0?"black":"white")||d.push([b+1,c+2])),6>b&&c>0&&(0==a[b+2][c-1]||a[b+2][c-1]*a[b][c]<0)&&(i([b,c],[b+2,c-1],a[b][c]<0?"black":"white")||d.push([b+2,c-1])),6>b&&7>c&&(0==a[b+2][c+1]||a[b+2][c+1]*a[b][c]<0)&&(i([b,c],[b+2,c+1],a[b][c]<0?"black":"white")||d.push([b+2,c+1])),d}}function u(a,b,c){if(3.2==Math.abs(a[b][c])){var d=[];return b>0&&c>1&&d.push([b-1,c-2]),b>0&&6>c&&d.push([b-1,c+2]),b>1&&c>0&&d.push([b-2,c-1]),b>1&&7>c&&d.push([b-2,c+1]),7>b&&c>1&&d.push([b+1,c-2]),7>b&&6>c&&d.push([b+1,c+2]),6>b&&c>0&&d.push([b+2,c-1]),6>b&&7>c&&d.push([b+2,c+1]),d}}function v(a){for(var b=a.length-1;b>=0;b--)$(".row:eq("+a[b][0]+") .tile:eq("+a[b][1]+")").addClass("possibility")}function w(){$(".possibility").removeClass("possibility")}window.board=[[5.1,3.2,3.33,8.8,41,3.33,3.2,5.1],[1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[-1,-1,-1,-1,-1,-1,-1,-1],[-5.1,-3.2,-3.33,-8.8,-41,-3.33,-3.2,-5.1]],window.dangerMapWhite=b(board,"white"),window.dangerMapBlack=b(board,"black");var x=d("white"),y=d("black"),z=[],A=1;a(board),$(document).on("click",".piece",function(){if(!$(this).parent().hasClass("possibility")){var a=$(".row .tile").index($(this).parent())%8,b=Math.floor($(".row .tile").index($(this).parent())/8);if(!(0==A&&board[b][a]<0||1==A&&board[b][a]>0))if(z.length){w(),z=[];var c=h(board,b,a);c&&v(c),z=[b,a]}else{var c=h(board,b,a);c&&v(c),z=[b,a]}}}),$(document).on("click",".possibility",function(){if(z.length){var c=$(".row .tile").index(this)%8,e=Math.floor($(".row .tile").index(this)/8),f=board[z[0]][z[1]];board[z[0]][z[1]]=0,41==Math.abs(board[e][c])&&($(document).off("click",".piece"),$("body").prepend((board[e][c]>0?"White":"Black")+" won the game! Congrats!")),board[e][c]=f,z=[],w(),A=A?0:1,window.dangerMapWhite=b(board,"black"),window.dangerMapBlack=b(board,"white"),x=d("white"),y=d("black"),a(board)}})});